---
// src/pages/wiki/index.astro
import { getCollection, type CollectionEntry } from "astro:content";
import "../../styles/global.css";

type WikiEntry = CollectionEntry<"wiki">;

const wikiEntries = (await getCollection("wiki")) as WikiEntry[];

const modulesMap = new Map<string, { title: string; items: WikiEntry[] }>();

for (const entry of wikiEntries) {
  const { module, moduleTitle } = entry.data;
  if (!modulesMap.has(module)) {
    modulesMap.set(module, { title: moduleTitle, items: [] });
  }
  modulesMap.get(module)!.items.push(entry);
}

const modules = Array.from(modulesMap.entries()).map(([id, value]) => ({
  id,
  title: value.title,
  items: value.items.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0)),
}));
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Wiki del Curso</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <main class="mx-auto max-w-6xl px-4 py-10">
      <h1 class="text-3xl font-bold tracking-tight text-slate-50">
        Wiki del Curso
      </h1>
      <p class="mt-2 max-w-2xl text-sm text-slate-300">
        Globalización, economía digital y modelos de negocio, y computación en
        la nube con Big Data y Power BI.
      </p>

      <section class="mt-8 grid gap-6 md:grid-cols-3">
        {
          modules.map((mod) => {
            const mainEntry = mod.items[0];

            return (
              <a
                href={`/wiki/${mainEntry.slug}`}
                class="group flex flex-col rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-sm shadow-slate-950/40 transition hover:-translate-y-1 hover:border-sky-500 hover:shadow-lg hover:shadow-sky-900/40"
              >
                <h2 class="text-lg font-semibold text-slate-50 group-hover:underline">
                  {mod.title}
                </h2>

                {mainEntry.data.summary && (
                  <p class="mt-2 text-xs text-slate-300">
                    {mainEntry.data.summary}
                  </p>
                )}

                <div class="mt-4 flex flex-wrap gap-2">
                  {mainEntry.data.tags?.slice(0, 3).map((tag) => (
                    <span class="rounded-full border border-slate-700 px-2 py-0.5 text-[0.65rem] uppercase tracking-wide text-slate-400">
                      {tag}
                    </span>
                  ))}
                </div>

                <div class="mt-4 flex items-center justify-between text-xs text-slate-400">
                  <span>Entrar al módulo</span>
                  <span
                    aria-hidden="true"
                    class="transition group-hover:translate-x-0.5"
                  >
                    →
                  </span>
                </div>
              </a>
            );
          })
        }
      </section>
    </main>
  </body>
</html>
